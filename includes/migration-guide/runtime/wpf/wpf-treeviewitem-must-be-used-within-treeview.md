### WPF TreeViewItem must be used within a TreeView

|   |   |
|---|---|
|Details|A change was introduced in 4.5 that restricts usage of <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> elements outside of a <xref:System.Windows.Controls.TreeView?displayProperty=name>. This manifests under the following conditions:<ul><li><xref:System.Windows.Controls.TreeViewItem?displayProperty=name>&#39;s visual parent is not a panel. (A <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> generated for a <xref:System.Windows.Controls.TreeView?displayProperty=name> will have a panel as its parent)</li><li>The <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> is a descendant of a <xref:System.Windows.Controls.VirtualizingStackPanel?displayProperty=name> acting as the &quot;items host&quot; for a list control (ListBox, DataGrid, ListView, etc.). Virtualization doesn&#39;t need to be enabled.</li><li>The <xref:System.Windows.Controls.VirtualizingStackPanel?displayProperty=name> is item-scrolling (<code>ScrollUnit=&quot;Item&quot;</code>).</li><li>Someone calls <code>VirtualizingStackPanel.MakeVisible(v)</code> to scroll an element <code>v</code> into view. This can be done explicitly, or implicitly in a number of ways; perhaps the most common way is simply clicking on <code>v</code> to give it the keyboard focus.</li><li>The visual-parent chain from <code>v</code> to the <xref:System.Windows.Controls.VirtualizingStackPanel?displayProperty=name> passes through the <xref:System.Windows.Controls.TreeViewItem?displayProperty=name>.</li></ul>In other words, this is seen when a <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> is used outside of a <xref:System.Windows.Controls.TreeView?displayProperty=name>, and the user clicks on a descendant of the <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> to bring it into view. If the <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> has no focusable descendants, you&#39;ll never see this issue. An example of a situation where this is hit is when a <xref:System.Windows.Controls.TreeViewItem?displayProperty=name> is the root of a DataTemplate. When this issue is hit, there is an InvalidCastException that occurs within the WPF framework.|
|Suggestion|A hotfix will be made available for this.|
|Scope|Minor|
|Version|4.5|
|Type|Runtime|
|Analyzers|<ul><li>CD0141</li></ul>|

