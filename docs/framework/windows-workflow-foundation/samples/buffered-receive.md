---
title: "Buffered Receive"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 9d46d9b9-96c9-4531-9695-ab526b4d704a
caps.latest.revision: 7
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
---
# Buffered Receive
This sample demonstrates how to set up and configure the buffered receive feature in [!INCLUDE[wf](../../../../includes/wf-md.md)]. Buffered receive allows the workflow author to create a workflow without having to worry about the order in which messages are received. The buffered receive feature buffers messages locally and delivers them when the workflow is ready to receive them.  
  
## Demonstrates  
 Out-of-order message processing using buffered receive with messaging activities.  
  
> [!IMPORTANT]
>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Services\BufferedReceive`  
  
## Discussion  
 In this sample, a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service is implemented using [!INCLUDE[wf1](../../../../includes/wf1-md.md)] and has a sequence of <xref:System.ServiceModel.Activities.Receive> activities. This workflow models a simple loan approval process where the workflow expects three notifications for a loan to be approved. A [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client application sends three correlated notifications in the reverse order of what the service expects. Because the buffered receive feature is turned on at the service, each out-of-order message is buffered at the service and processed as the workflow becomes ready to receive it.  
  
 The buffered receive feature requires <xref:System.ServiceModel.Activities.ReceiveContent> support from the binding, therefore the service uses <xref:System.ServiceModel.NetMsmqBinding>. No special configuration is required for the binding, so the defaults are used.  
  
```xml  
<endpoint address ="net.msmq://localhost/private/LoanService/Service1.xamlx"  
                  binding="netMsmqBinding"  
                  contract="ILoanService"/>  
```  
  
 The service also exposes metadata for the service using <xref:System.ServiceModel.Description.ServiceMetadataBehavior>.  
  
 Similarly, the client endpoint is configured using <xref:System.ServiceModel.NetMsmqBinding>. The client code and configuration is generated by using the **Add Service Reference** feature of [!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)]. The following example is the generated client endpoint in the App.config file.  
  
```xml  
<endpoint address="net.msmq://localhost/private/LoanService/Service1.xamlx"  
                binding="netMsmqBinding" bindingConfiguration="NetMsmqBinding_ILoanService"  
                contract="ServiceReference1.ILoanService" name="NetMsmqBinding_ILoanService" />  
```  
  
 This sample requires that the following Windows components are enabled:  
  
1.  [!INCLUDE[iis60](../../../../includes/iis60-md.md)]  
  
2.  [!INCLUDE[iis60](../../../../includes/iis60-md.md)] Management Compatibility, Metabase, and Configuration Compatibility  
  
3.  World Wide Web Services, Application Development Features, and ASP.NET  
  
4.  Microsoft Message Queues (MSMQ) Server  
  
#### To set up, and build the sample  
  
1.  At a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt, register ASP.NET by typing `aspnet_regiis â€“I` and press ENTER.  
  
2.  Run [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] as an Administrator.  
  
3.  Open LoanService.sln.  
  
4.  When asked if you would like to create the virtual directories for the LoanService project, select **Yes**.  
  
#### To set up the service queues  
  
1.  Press F5 to run the LoanClient application that creates the queues and activates the service defined in Service1.xamlx.  
  
2.  Open the **Computer Management** console by running Compmgmt.msc from a command prompt.  
  
3.  In the **Computer Management** console, expand **Service**, **Applications**, **Message Queuing**, **Private Queues**.  
  
4.  Right-click the loanservice/service1.xamlx queue and select **Properties**.  
  
5.  Select the **Security** tab, and add **Everyone Receives Message**, **Peek Message** and **Send Message** permissions.  
  
6.  Open the [!INCLUDE[iis60](../../../../includes/iis60-md.md)] Manager.  
  
7.  Browse to **Server**, **Sites**, **Default Web site**, **Private**, **LoanService** and select **Advanced Options**  
  
8.  Change the **Enabled Protocols** to be **http**, **net.msmq**.  
  
#### To run the sample  
  
1.  Browse to http://localhost/private/loanservice/service1.xamlx to ensure that the service is running.  
  
2.  Press F5 to run the LoanClient application. Once the workflow is complete, an out.txt file should be saved to C:\Inbox that contains the result of the message exchange.  
  
#### To clean up  
  
1.  Open the **Computer Management** console by running Compmgmt.msc from a command prompt.  
  
2.  Expand **Service** and **Applications**, **Message Queuing**, **Private Queues**.  
  
3.  Delete the loanservice/service1.xamlx queue.  
  
4.  Remove the C:\Inbox directory.  
  
> [!IMPORTANT]
>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Services\BufferedReceive`
